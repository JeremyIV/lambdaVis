<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lambda Calculus Visualizer</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="common.js"></script>
    <script src="macros.js"></script>
    <script src="parseChurchLambdaString.js"></script>
    <script src="churchLambdaToString.js"></script>
    <script src="lambdaCalculus.js"></script>
    <script src="expressions.js"></script>
    <script src="lambdaRenderer.js"></script>
    <link rel="stylesheet" href="lambda.css">
</head>
<body>
    <header>
        <h1>Lambda Calculus Visualizer</h1>
    </header>
    
    <main>
        <div class="controls">
            <div class="input-group">
                <textarea id="lambdaString" rows="1" placeholder="Enter lambda expression, e.g. (:x y.x)(:x y.y)" spellcheck="false"></textarea>
                <button type="button" id="expand-btn" class="expand-btn" title="Expand to multi-line editor">&#x25BC;</button>
            </div>
            <div class="button-group">
                <button type="button" id="load-btn" onclick="parseAndLoad()">Load</button>
                <button type="button" id="reduce-btn" onclick="update()">Beta Reduce</button>
                <button type="button" id="back-btn" onclick="goBack()">Go Back</button>
            </div>
        </div>
        
        <div class="content">
            <div id="tree-container">
                <!-- SVG will be inserted here -->
            </div>
            
            <aside class="sidebar">
                <section class="current-expression">
                    <h3>Current Expression</h3>
                    <code id="current-expr">-</code>
                </section>
                
                <section class="examples">
                    <h3>Examples</h3>
                    <div class="example-list" id="example-list">
                        <!-- Examples will be populated by JavaScript -->
                    </div>
                </section>
                
                <section class="syntax-help">
                    <h3>Syntax</h3>
                    <dl>
                        <dt><code>:x.body</code></dt>
                        <dd>Lambda (λx.body)</dd>
                        <dt><code>:x y.body</code></dt>
                        <dd>Multi-param lambda</dd>
                        <dt><code>f x</code></dt>
                        <dd>Application (f applied to x)</dd>
                        <dt><code>(expr)</code></dt>
                        <dd>Grouping</dd>
                    </dl>
                </section>
                
                <section class="legend">
                    <h3>Legend</h3>
                    <div class="legend-items">
                        <div class="legend-item">
                            <span class="legend-circle lambda"></span>
                            <span>Lambda (λ)</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-circle variable"></span>
                            <span>Variable</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-circle application"></span>
                            <span>Application</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-line"></span>
                            <span>Tree edge</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-curve"></span>
                            <span>Variable binding</span>
                        </div>
                    </div>
                </section>
            </aside>
        </div>
    </main>
    
    <script>
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initialize);

        const lambdaInput = document.getElementById('lambdaString');
        const expandBtn = document.getElementById('expand-btn');
        let expanded = false;

        // Handle keyboard in textarea
        lambdaInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                if (!expanded) {
                    // Single-line mode: Enter submits
                    e.preventDefault();
                    parseAndLoad();
                } else if (e.ctrlKey || e.metaKey) {
                    // Multi-line mode: Ctrl/Cmd+Enter submits
                    e.preventDefault();
                    parseAndLoad();
                }
            }
        });

        // Toggle expand/collapse
        expandBtn.addEventListener('click', function() {
            expanded = !expanded;
            document.body.classList.toggle('editor-expanded', expanded);
            lambdaInput.classList.toggle('expanded', expanded);
            expandBtn.classList.toggle('expanded', expanded);
            expandBtn.innerHTML = expanded ? '&#x25B2;' : '&#x25BC;';
            expandBtn.title = expanded ? 'Collapse to single line' : 'Expand to multi-line editor';
            if (expanded) {
                lambdaInput.style.resize = 'vertical';
            } else {
                lambdaInput.style.resize = 'none';
                lambdaInput.style.height = '';
            }
            lambdaInput.focus();
        });
    </script>
</body>
</html>
